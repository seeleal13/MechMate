{% extends "base.html" %}
{% block content %}
<div class="container">
    <h2>Add Vehicle</h2>
    <form method="POST">
        {{ form.hidden_tag() }}
        <div class="form-group">
            {{ form.make.label }} {{ form.make(class="form-control") }}
        </div>
        <div class="form-group">
            {{ form.model.label }} {{ form.model(class="form-control") }}
        </div>
        <div class="form-group">
            {{ form.year.label }} {{ form.year(class="form-control") }}
        </div>
        <div class="form-group">
            {{ form.license_plate.label }} {{ form.license_plate(class="form-control", placeholder="Enter license plate") }}
        </div>
        {{ form.submit(class="btn btn-primary") }}
    </form>
    <a href="{{ url_for('dashboard') }}" class="btn btn-secondary mt-3">Back to Dashboard</a>
</div>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const makeSelect = document.querySelector('#make');
        const modelSelect = document.querySelector('#model');
        const yearSelect = document.querySelector('#year');

        makeSelect.addEventListener('change', function() {
            const make = this.value;
            modelSelect.innerHTML = '<option value="">Select Model</option>';
            yearSelect.innerHTML = '<option value="">Select Year</option>';
            if (make) {
                fetch(`/api/models/${make}`)
                    .then(response => response.json())
                    .then(data => {
                        data.forEach(model => {
                            const option = document.createElement('option');
                            option.value = model[0];
                            option.text = model[1];
                            modelSelect.appendChild(option);
                        });
                    })
                    .catch(error => console.error('Error fetching models:', error));
            }
        });

        modelSelect.addEventListener('change', function() {
            const make = makeSelect.value;
            const model = this.value;
            yearSelect.innerHTML = '<option value="">Select Year</option>';
            if (make && model) {
                fetch(`/api/years/${make}/${model}`)
                    .then(response => response.json())
                    .then(data => {
                        data.forEach(year => {
                            const option = document.createElement('option');
                            option.value = year[0];
                            option.text = year[1];
                            yearSelect.appendChild(option);
                        });
                    })
                    .catch(error => console.error('Error fetching years:', error));
            }
        });
    });
</script>
{% endblock %}